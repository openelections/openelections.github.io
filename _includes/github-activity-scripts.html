<!-- GitHub Activity Page Scripts -->

<!-- Simple GitHub API Configuration -->
<script>
// Simple GitHub API setup
window.GITHUB_ORG = 'openelections';
window.GITHUB_API_BASE = 'https://api.github.com';

// Simple fetch wrapper for GitHub API
async function fetchFromGitHub(endpoint) {
  try {
    const response = await fetch(`${window.GITHUB_API_BASE}${endpoint}`);
    if (!response.ok) {
      throw new Error(`GitHub API error: ${response.status}`);
    }
    return await response.json();
  } catch (error) {
    console.error('GitHub API fetch error:', error);
    throw error;
  }
}
</script>

<!-- Initialize Activity Page -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  loadGitHubActivity();
});

// Simple function to load and display GitHub activity
async function loadGitHubActivity() {
  const loadingElement = document.getElementById('activity-loading');
  const errorElement = document.getElementById('activity-error');
  const contentElement = document.getElementById('activity-list');
  
  try {
    // Show loading
    if (loadingElement) loadingElement.classList.remove('d-none');
    if (errorElement) errorElement.classList.add('d-none');
    if (contentElement) contentElement.classList.add('d-none');
    
    // Fetch repositories
    const repos = await fetchFromGitHub(`/orgs/${window.GITHUB_ORG}/repos?sort=updated&per_page=10`);
    
    // Display results
    if (contentElement && repos.length > 0) {
      displayRepositories(repos);
      if (loadingElement) loadingElement.classList.add('d-none');
      contentElement.classList.remove('d-none');
    }
    
  } catch (error) {
    console.error('Failed to load GitHub activity:', error);
    if (loadingElement) loadingElement.classList.add('d-none');
    if (errorElement) errorElement.classList.remove('d-none');
  }
}

// Simple function to display repositories
function displayRepositories(repos) {
  const container = document.getElementById('activity-list');
  if (!container) return;
  
  const html = repos.map(repo => `
    <div class="p-3 border-bottom">
      <div class="d-flex justify-content-between align-items-start">
        <div class="flex-grow-1">
          <h6 class="mb-1">
            <a href="${repo.html_url}" target="_blank" rel="noopener" class="text-decoration-none">${repo.name}</a>
          </h6>
          <p class="mb-2 text-muted small">${repo.description || 'No description available'}</p>
          <div class="d-flex align-items-center">
            <small class="text-muted me-3">
              <i class="fas fa-clock me-1"></i>Updated: ${new Date(repo.updated_at).toLocaleDateString()}
            </small>
            ${repo.language ? `<span class="badge bg-secondary small">${repo.language}</span>` : ''}
          </div>
        </div>
        <div class="ms-3">
          <a href="${repo.html_url}" class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener">
            <i class="fab fa-github me-1"></i>View
          </a>
        </div>
      </div>
    </div>
  `).join('');
  
  container.innerHTML = html;
}

// Global retry function
function retryLoadActivity() {
  loadGitHubActivity();
}
</script>
